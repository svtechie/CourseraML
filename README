Forked version with minor fixes
